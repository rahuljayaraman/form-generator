<h2><%= @report.report_name.humanize %> Report</h2>
<hr>
<table class = "table table-bordered" id="datatables">
  <thead>
    <% @attributes.each do |m| -%>
      <th><%= m.field_name.humanize %></th>
    <% end -%>
  </thead>

  <tbody>
  <% @data.each do |d| %>
    <tr>
    <% @attributes.each do |m| -%>
      <% if @report.find_direct_attributes.include? m -%>
        <td><%= d.send(m.field_name.attribute) || "N/A" %></td>
      <% elsif @report.find_belongs_to_attributes.include? m -%>
      <td><%= d.send(m.source.collection_name_helper.singularize).send(m.field_name.attribute) || "N/A" rescue "N/A"%></td>
      <% elsif @report.find_habtm_attributes.include? m -%>
        <td><%= d.send(m.source.collection_name_helper).map(&m.field_name.attribute.to_sym).join(", ") || "N/A" %></td>
      <% elsif @report.find_has_many_attributes.include? m -%>
        <td><%= d.send(m.source.collection_name_helper).map(&m.field_name.attribute.to_sym).join(", ") || "N/A" %></td>
      <% else -%>
          <td><%= d.send(m.field_name.attribute).to_s(:short) rescue "N/A" %></td>
      <% end -%>
    <% end -%>
    </tr>
  <% end %>
</tbody>
</table>

<div class="form-actions"><%= link_to 'Back', :back, class: "btn" %></div>
